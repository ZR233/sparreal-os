name: Check, Build and Test

on: [push, pull_request]

env:
  CARGO_TERM_COLOR: always

jobs:
  ci:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Install toolchain
      run: rustup show
    - name: Check rust version
      run: rustc --version --verbose
    - name: Check code format
      run: cargo fmt --all -- --check
    - name: Clippy
      run: cargo clippy -- -D warnings
    # - name: Build
    #   run: cargo build 
# crates/sparreal-macros
# crates/page-table-arm
# /sparreal-kernel

    - name: Install ostool
      run: |
        sudo apt install libudev-dev -y # ZR233/ostool requires
        cargo install ostool
    - name: Test bare-test
      working-directory: app/simple_test
      run: cargo test --test test1
